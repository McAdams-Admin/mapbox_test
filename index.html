<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Mapbox Map Starter - Cleaned</title>
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.4.0/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.4.0/mapbox-gl.css" rel="stylesheet" />
    <style>
        body { margin: 0; font-family: Arial, sans-serif; }
        #map { height: 100vh; width: 100%; }
        .map-overlay {
            position: absolute; top: 10px; left: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px; border-radius: 5px;
            font-size: 14px; z-index: 1;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .map-overlay h3 { margin: 0 0 10px; color: #333; }
        button {
            margin: 2px; padding: 5px 10px;
            background: #007cbf; color: white;
            border: none; border-radius: 3px;
            cursor: pointer; font-size: 12px;
        }
        button:hover { background: #005a8b; }
        input[type="text"] {
            padding: 6px 8px; border: 1px solid #ccc;
            border-radius: 3px; font-size: 12px;
            width: 100%; box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <div class="map-overlay">
        <h3>Office Locations</h3>
        <div id="fly-buttons"></div>
        <div style="margin-top: 10px; font-size: 12px; color: #666;">
            Zoom: <span id="zoom-level">15</span><br>
            Center: <span id="coordinates">Loading...</span>
        </div>
    </div>

    <div style="position: absolute; top: 10px; right: 10px; z-index: 10000; background: white; border: 1px solid #ccc; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.2); padding: 15px; min-width: 250px;">
        <div style="font-weight: bold; margin-bottom: 10px; font-size: 14px; color: #333;">Go to Location</div>
        <div style="margin-bottom: 10px;">
            <input id="searchInput" type="text" placeholder="Enter address or lng,lat" />
            <button id="searchBtn" style="width: 100%; padding: 8px; font-size: 13px;">Search</button>
        </div>
        <div style="font-size: 11px; color: #666;">
            Examples:<br>
            ‚Ä¢ "1600 Pennsylvania Ave, Washington DC"<br>
            ‚Ä¢ "-78.6382,35.7796"
        </div>
    </div>

    <div style="position: absolute; bottom: 20px; left: 20px; z-index: 10000; background: white; border: 1px solid #ccc; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
        <div id="layerToggle" style="padding: 10px 15px; cursor: pointer; font-weight: bold; font-size: 14px; color: #333; border-bottom: 1px solid #eee;">
            <span>Map Layers</span><span id="panelArrow" style="float: right;">‚ñº</span>
        </div>
        <div id="layerPanelContent" style="display: none; padding: 15px; min-width: 160px;">
            <label><input type="checkbox" id="officeLayer" checked /> Office Buildings</label><br>
            <label><input type="checkbox" id="geojsonLayer" checked /> GeoJSON Data</label><br>
            <label><input type="checkbox" id="homeLayer" checked /> Home Location</label>
        </div>
    </div>

    <script>
        const MAPBOX_TOKEN = 'pk.eyJ1Ijoic21pdGhtYjAyNDQiLCJhIjoiY21mNGV2YjhkMDRxdjJqcThhN3I3MDU3ZSJ9.jjhwaF_pzxV0Y1fUFC5wGA';
        mapboxgl.accessToken = MAPBOX_TOKEN;

        const LAYER_IDS = {
            GEOJSON: 'geojson-points'
        };

        let homeMarker = null;
        let officeMarkers = [];
        let searchMarker = null;

        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v12',
            center: [-78.6440, 35.7890],
            zoom: 15
        });

        map.addControl(new mapboxgl.NavigationControl());
        map.addControl(new mapboxgl.FullscreenControl());
        map.addControl(new mapboxgl.GeolocateControl({
            positionOptions: { enableHighAccuracy: true },
            trackUserLocation: true,
            showUserHeading: true
        }));

        map.on('load', () => {
            homeMarker = new mapboxgl.Marker({ color: '#ff6b6b' })
                .setLngLat([-78.6440, 35.7890])
                .setPopup(new mapboxgl.Popup().setHTML('<h4>621 Hillsborough St</h4><p>Raleigh, NC - Home Location</p>'))
                .addTo(map);

            const offices = [
                { coords: [-78.6386, 35.7721], name: 'Raleigh Office' },
                { coords: [-80.8414, 35.2271], name: 'Charlotte Office' },
                { coords: [-80.2442, 36.0999], name: 'Winston-Salem Office' },
                { coords: [-82.5540, 35.5951], name: 'Asheville Office' },
                { coords: [-78.8986, 35.9940], name: 'Durham Office' },
                { coords: [-82.3940, 34.8526], name: 'Greenville Office' },
                { coords: [-97.0403, 33.0462], name: 'Lewisville Office' },
                { coords: [-81.3792, 28.5383], name: 'Orlando Office' },
                { coords: [-82.4572, 27.9506], name: 'Tampa Office' }
            ];

            const buttonContainer = document.getElementById('fly-buttons');
            offices.forEach(({ coords, name }) => {
                const marker = new mapboxgl.Marker({ element: createEmojiMarker('üè¢') })
                    .setLngLat(coords)
                    .setPopup(new mapboxgl.Popup().setHTML(`<h4>${name}</h4>`))
                    .addTo(map);
                officeMarkers.push(marker);

                const btn = document.createElement('button');
                btn.textContent = name.split(' ')[0]; // City only
                btn.addEventListener('click', () => flyToCoordinates(coords, name));
                buttonContainer.appendChild(btn);
            });

            loadGeoJSON();
            updateInfo();
        });

        async function loadGeoJSON() {
            try {
                const res = await fetch('https://raw.githubusercontent.com/McAdams-Admin/mapbox_test/refs/heads/main/Request_Form_Output_Test.geojson');
                if (!res.ok) throw new Error(res.status);
                const data = await res.json();

                if (map.getSource('geojson-data')) {
                    map.getSource('geojson-data').setData(data);
                } else {
                    map.addSource('geojson-data', { type: 'geojson', data });

                    map.addLayer({
                        id: LAYER_IDS.GEOJSON,
                        type: 'circle',
                        source: 'geojson-data',
                        filter: ['==', '$type', 'Point'],
                        paint: {
                            'circle-radius': 8,
                            'circle-color': '#3498db',
                            'circle-stroke-color': '#fff',
                            'circle-stroke-width': 2
                        }
                    });

                    map.on('click', LAYER_IDS.GEOJSON, (e) => {
                        const props = e.features[0].properties;
                        let html = '<div>';
                        for (const k in props) {
                            if (props[k]) html += `<strong>${k}:</strong> ${props[k]}<br>`;
                        }
                        html += '</div>';
                        new mapboxgl.Popup().setLngLat(e.lngLat).setHTML(html).addTo(map);
                    });
                }
            } catch (err) {
                console.error('GeoJSON load error:', err);
            }
        }

        function flyToCoordinates(coords, name = '') {
            if (searchMarker) searchMarker.remove();
            searchMarker = new mapboxgl.Marker({ color: '#28a745' })
                .setLngLat(coords)
                .setPopup(new mapboxgl.Popup().setHTML(`<h4>${name || 'Search Result'}</h4>`))
                .addTo(map);
            map.flyTo({ center: coords, zoom: 14, duration: 2000 });
        }

        function updateInfo() {
            const c = map.getCenter();
            document.getElementById('coordinates').textContent = `${c.lng.toFixed(4)}, ${c.lat.toFixed(4)}`;
            document.getElementById('zoom-level').textContent = map.getZoom().toFixed(1);
        }

        function createEmojiMarker(emoji) {
            const el = document.createElement('div');
            el.innerHTML = emoji;
            el.style.fontSize = '24px';
            el.style.cursor = 'pointer';
            return el;
        }

        map.on('move', updateInfo);

        document.getElementById('searchBtn').addEventListener('click', searchLocation);
        document.getElementById('searchInput').addEventListener('keypress', e => {
            if (e.key === 'Enter') searchLocation();
        });

        async function searchLocation() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return alert('Please enter a search value');
            const coordPattern = /^-?\d+\.?\d*,-?\d+\.?\d*$/;
            if (coordPattern.test(query)) {
                const [lng, lat] = query.split(',').map(Number);
                if (lat >= -90 && lat <= 90 && lng >= -180 && lng <= 180) {
                    flyToCoordinates([lng, lat], `${lng}, ${lat}`);
                } else alert('Invalid coordinates.');
                return;
            }

            try {
                const res = await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(query)}.json?access_token=${MAPBOX_TOKEN}`);
                const data = await res.json();
                if (data.features?.length) {
                    const f = data.features[0];
                    flyToCoordinates(f.center, f.place_name);
                } else alert('Location not found.');
            } catch (err) {
                console.error(err);
                alert('Search failed.');
            }
        }

        document.getElementById('layerToggle').addEventListener('click', () => {
            const content = document.getElementById('layerPanelContent');
            const arrow = document.getElementById('panelArrow');
            const visible = content.style.display === 'block';
            content.style.display = visible ? 'none' : 'block';
            arrow.textContent = visible ? '‚ñº' : '‚ñ≤';
        });

        ['officeLayer', 'geojsonLayer', 'homeLayer'].forEach(id => {
            document.getElementById(id).addEventListener('change', () => toggleLayer(id));
        });

        function toggleLayer(id) {
            switch (id) {
                case 'officeLayer':
                    officeMarkers.forEach(m => document.getElementById(id).checked ? m.addTo(map) : m.remove());
                    break;
                case 'geojsonLayer':
                    if (map.getLayer(LAYER_IDS.GEOJSON)) {
                        map.setLayoutProperty(LAYER_IDS.GEOJSON, 'visibility', document.getElementById(id).checked ? 'visible' : 'none');
                    }
                    break;
                case 'homeLayer':
                    homeMarker && (document.getElementById(id).checked ? homeMarker.addTo(map) : homeMarker.remove());
                    break;
            }
        }
    </script>
</body>
</html>




















