<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapbox Map Starter</title>
    <script src='https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css' rel='stylesheet' />
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        
        #map {
            height: 100vh;
            width: 100%;
        }
        
        .map-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            z-index: 1;
        }
        
        .map-overlay h3 {
            margin: 0 0 10px 0;
            color: #333;
        }
        
        button {
            margin: 2px;
            padding: 5px 10px;
            background: #007cbf;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        
        button:hover {
            background: #005a8b;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <!-- Main overlay (top left) -->
    <div class="map-overlay">
        <h3>Office Locations</h3>
        
        <div>
            <button onclick="flyToLocation([-78.6386, 35.7721])">Raleigh, NC</button>
            <button onclick="flyToLocation([-80.8414, 35.2271])">Charlotte, NC</button>
            <button onclick="flyToLocation([-80.2442, 36.0999])">Winston-Salem, NC</button>
            <button onclick="flyToLocation([-82.5540, 35.5951])">Asheville, NC</button>
            <button onclick="flyToLocation([-78.8986, 35.9940])">Durham, NC</button>
            <button onclick="flyToLocation([-82.3940, 34.8526])">Greenville, SC</button>
            <button onclick="flyToLocation([-97.0403, 33.0462])">Lewisville, TX</button>
            <button onclick="flyToLocation([-81.3792, 28.5383])">Orlando, FL</button>
            <button onclick="flyToLocation([-82.4572, 27.9506])">Tampa, FL</button>
        </div>
        
        <div style="margin-top: 10px; font-size: 12px; color: #666;">
            Zoom: <span id="zoom-level">15</span><br>
            Center: <span id="coordinates">Loading...</span>
        </div>
    </div>
    
    <!-- COLLAPSIBLE LAYER CONTROL PANEL (bottom left) -->
    <div style="position: absolute; bottom: 20px; left: 20px; z-index: 10000; background: white; border: 1px solid #ccc; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
        
        <!-- Panel Header (always visible) -->
        <div onclick="toggleLayerPanel()" style="padding: 10px 15px; cursor: pointer; font-weight: bold; font-size: 14px; color: #333; border-bottom: 1px solid #eee; user-select: none;">
            <span id="panelTitle">Map Layers</span>
            <span id="panelArrow" style="float: right;">‚ñ≤</span>
        </div>
        
        <!-- Panel Content (collapsible) -->
        <div id="layerPanelContent" style="padding: 15px; min-width: 160px;">
            <label style="display: block; margin: 8px 0; cursor: pointer; font-size: 13px;">
                <input type="checkbox" id="officeLayer" checked onchange="toggleLayer('offices')" style="margin-right: 8px;">
                Office Buildings
            </label>
            
            <label style="display: block; margin: 8px 0; cursor: pointer; font-size: 13px;">
                <input type="checkbox" id="geojsonLayer" checked onchange="toggleLayer('geojson')" style="margin-right: 8px;">
                GeoJSON Data
            </label>
            
            <label style="display: block; margin: 8px 0; cursor: pointer; font-size: 13px;">
                <input type="checkbox" id="homeLayer" checked onchange="toggleLayer('home')" style="margin-right: 8px;">
                Home Location
            </label>
        </div>
    </div>

    <script>
        // Mapbox access token
        mapboxgl.accessToken = 'pk.eyJ1Ijoic21pdGhtYjAyNDQiLCJhIjoiY21mNGV2YjhkMDRxdjJqcThhN3I3MDU3ZSJ9.jjhwaF_pzxV0Y1fUFC5wGA';
        
        // Store layer references
        let homeMarker = null;
        let officeMarkers = [];
        
        // Initialize map
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v12',
            center: [-78.6440, 35.7890],
            zoom: 15
        });
        
        // Add controls
        map.addControl(new mapboxgl.NavigationControl());
        map.addControl(new mapboxgl.FullscreenControl());
        map.addControl(new mapboxgl.GeolocateControl({
            positionOptions: { enableHighAccuracy: true },
            trackUserLocation: true,
            showUserHeading: true
        }));
        
        // When map loads
        map.on('load', function() {
            console.log('Map loaded successfully');
            
            // Add home marker
            homeMarker = new mapboxgl.Marker({ color: '#ff6b6b' })
                .setLngLat([-78.6440, 35.7890])
                .setPopup(new mapboxgl.Popup().setHTML('<h4>621 Hillsborough St</h4><p>Raleigh, NC - Home Location</p>'))
                .addTo(map);
            
            // Add office markers
            const offices = [
                { coords: [-78.6386, 35.7721], name: 'Raleigh Office', city: 'Raleigh, NC' },
                { coords: [-80.8414, 35.2271], name: 'Charlotte Office', city: 'Charlotte, NC' },
                { coords: [-80.2442, 36.0999], name: 'Winston-Salem Office', city: 'Winston-Salem, NC' },
                { coords: [-82.5540, 35.5951], name: 'Asheville Office', city: 'Asheville, NC' },
                { coords: [-78.8986, 35.9940], name: 'Durham Office', city: 'Durham, NC' },
                { coords: [-82.3940, 34.8526], name: 'Greenville Office', city: 'Greenville, SC' },
                { coords: [-97.0403, 33.0462], name: 'Lewisville Office', city: 'Lewisville, TX' },
                { coords: [-81.3792, 28.5383], name: 'Orlando Office', city: 'Orlando, FL' },
                { coords: [-82.4572, 27.9506], name: 'Tampa Office', city: 'Tampa, FL' }
            ];
            
            offices.forEach(office => {
                const buildingMarker = document.createElement('div');
                buildingMarker.innerHTML = 'üè¢';
                buildingMarker.style.fontSize = '24px';
                buildingMarker.style.cursor = 'pointer';
                
                const marker = new mapboxgl.Marker({ element: buildingMarker })
                    .setLngLat(office.coords)
                    .setPopup(new mapboxgl.Popup().setHTML(`<h4>${office.name}</h4><p>${office.city}</p>`))
                    .addTo(map);
                
                officeMarkers.push(marker);
            });
            
            // Load GeoJSON data
            loadGeoJSONData();
            updateInfo();
        });
        
        // Load GeoJSON data
        async function loadGeoJSONData() {
            try {
                console.log('Attempting to fetch GeoJSON...');
                const response = await fetch('https://raw.githubusercontent.com/McAdams-Admin/mapbox_test/refs/heads/main/Request_Form_Output_Test.geojson');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const geojsonData = await response.json();
                console.log('GeoJSON loaded successfully:', geojsonData);
                
                map.addSource('geojson-data', {
                    type: 'geojson',
                    data: geojsonData
                });
                
                // Add layers
                map.addLayer({
                    id: 'geojson-points',
                    type: 'circle',
                    source: 'geojson-data',
                    filter: ['==', '$type', 'Point'],
                    paint: {
                        'circle-radius': 8,
                        'circle-color': '#3498db',
                        'circle-stroke-color': '#fff',
                        'circle-stroke-width': 2
                    }
                });
                
                // Add click handlers
                map.on('click', 'geojson-points', function(e) {
                    const properties = e.features[0].properties;
                    let content = '<div>';
                    
                    Object.keys(properties).forEach(key => {
                        if (properties[key] !== null && properties[key] !== undefined) {
                            content += `<strong>${key}:</strong> ${properties[key]}<br>`;
                        }
                    });
                    content += '</div>';
                    
                    new mapboxgl.Popup()
                        .setLngLat(e.lngLat)
                        .setHTML(content)
                        .addTo(map);
                });
                
            } catch (error) {
                console.error('Error loading GeoJSON:', error);
            }
        }
        
        // Update coordinate display
        map.on('move', updateInfo);
        
        function updateInfo() {
            const center = map.getCenter();
            const zoom = map.getZoom();
            document.getElementById('coordinates').textContent = `${center.lng.toFixed(4)}, ${center.lat.toFixed(4)}`;
            document.getElementById('zoom-level').textContent = zoom.toFixed(1);
        }
        
        // Fly to location
        function flyToLocation(coordinates) {
            map.flyTo({
                center: coordinates,
                zoom: 12,
                duration: 2000
            });
        }
        
        // Layer toggle function
        function toggleLayer(layerType) {
            console.log('Toggling layer:', layerType);
            
            switch(layerType) {
                case 'offices':
                    const officeChecked = document.getElementById('officeLayer').checked;
                    officeMarkers.forEach(marker => {
                        if (officeChecked) {
                            marker.addTo(map);
                        } else {
                            marker.remove();
                        }
                    });
                    break;
                    
                case 'geojson':
                    const geojsonChecked = document.getElementById('geojsonLayer').checked;
                    if (map.getLayer('geojson-points')) {
                        map.setLayoutProperty('geojson-points', 'visibility', geojsonChecked ? 'visible' : 'none');
                    }
                    break;
                    
                case 'home':
                    const homeChecked = document.getElementById('homeLayer').checked;
                    if (homeMarker) {
                        if (homeChecked) {
                            homeMarker.addTo(map);
                        } else {
                            homeMarker.remove();
                        }
                    }
                    break;
            }
        }
        
        // Panel collapse/expand function
        function toggleLayerPanel() {
            const content = document.getElementById('layerPanelContent');
            const arrow = document.getElementById('panelArrow');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                arrow.textContent = '‚ñ≤';
            } else {
                content.style.display = 'none';
                arrow.textContent = '‚ñº';
            }
        }
    </script>
</body>
</html>


