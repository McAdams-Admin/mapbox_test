<!-- FULL MAPBOX APP START -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mapbox Map Starter ‚Äì Geocoder Integrated</title>
  <!-- Mapbox GL JS -->
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet" />
  <!-- Mapbox Geocoder plugin -->
  <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.1/mapbox-gl-geocoder.css" />
  <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.1/mapbox-gl-geocoder.min.js"></script>
  <style>
    :root {
      --panel-bg: rgba(255, 255, 255, 0.95);
      --accent: #007cbf;
      --accent-hover: #005a8b;
      --text: #333;
      --muted: #666;
      --shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      --radius: 8px;
    }
    html, body { height: 100%; margin: 0; font-family: Arial, sans-serif; }
    #map { height: 100vh; width: 100%; }
    .map-overlay { position: absolute; top: 10px; left: 10px; background: var(--panel-bg); padding: 12px; border-radius: var(--radius); font-size: 14px; box-shadow: var(--shadow); z-index: 1; }
    .map-overlay h3 { margin: 0 0 10px; color: var(--text); }
    button { margin: 2px; padding: 6px 10px; background: var(--accent); color: #fff; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; }
    button:hover { background: var(--accent-hover); }
    .toast { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); background: #222; color: #fff; padding: 8px 12px; border-radius: 999px; box-shadow: var(--shadow); font-size: 12px; opacity: 0; pointer-events: none; transition: opacity 160ms ease; z-index: 10001; }
    .toast.show { opacity: 0.93; }
    .panel { background: #fff; border: 1px solid #ddd; border-radius: var(--radius); box-shadow: var(--shadow); }
    .panel-header { padding: 10px 14px; font-weight: bold; font-size: 14px; color: var(--text); border-bottom: 1px solid #eee; cursor: pointer; }
    .panel-body { padding: 14px; min-width: 180px; }
    @media (max-width: 640px) { .map-overlay { max-width: 70vw; } }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="toast" id="toast"></div>

  <!-- Office Locations overlay -->
  <div class="map-overlay">
    <h3>Office Locations</h3>
    <div>
      <button onclick="flyToLocation([-78.6386, 35.7721])">Raleigh, NC</button>
      <button onclick="flyToLocation([-80.8414, 35.2271])">Charlotte, NC</button>
      <button onclick="flyToLocation([-80.2442, 36.0999])">Winston-Salem, NC</button>
      <button onclick="flyToLocation([-82.554, 35.5951])">Asheville, NC</button>
      <button onclick="flyToLocation([-78.8986, 35.994])">Durham, NC</button>
      <button onclick="flyToLocation([-82.394, 34.8526])">Greenville, SC</button>
      <button onclick="flyToLocation([-97.0403, 33.0462])">Lewisville, TX</button>
      <button onclick="flyToLocation([-81.3792, 28.5383])">Orlando, FL</button>
      <button onclick="flyToLocation([-82.4572, 27.9506])">Tampa, FL</button>
    </div>
    <div style="margin-top:10px; font-size:12px; color:var(--muted);">
      Zoom: <span id="zoom-level">15</span><br />
      Center: <span id="coordinates">Loading...</span>
    </div>
  </div>

  <!-- Collapsible layer control -->
  <div class="panel" style="position:absolute; bottom:20px; left:20px; z-index:10000;">
    <div class="panel-header" id="layerPanelHeader" role="button" tabindex="0" aria-expanded="false" aria-controls="layerPanelContent" onclick="toggleLayerPanel()">
      <span id="panelTitle">Map Layers</span>
      <span id="panelArrow" style="float:right;">‚ñº</span>
    </div>
    <div id="layerPanelContent" class="panel-body" style="display:none;">
      <label><input type="checkbox" id="officeLayer" checked onchange="toggleLayer('offices')" /> Office Buildings</label><br />
      <label><input type="checkbox" id="geojsonLayer" checked onchange="toggleLayer('geojson')" /> GeoJSON Data</label><br />
      <label><input type="checkbox" id="homeLayer" checked onchange="toggleLayer('home')" /> Home Location</label>
    </div>
  </div>

  <script>
    mapboxgl.accessToken = 'YOUR_MAPBOX_TOKEN_HERE';
    let homeMarker=null, officeMarkers=[], searchMarker=null;

    const map=new mapboxgl.Map({container:'map', style:'mapbox://styles/mapbox/streets-v12', center:[-78.644,35.789], zoom:15});
    map.addControl(new mapboxgl.NavigationControl());
    map.addControl(new mapboxgl.FullscreenControl());
    map.addControl(new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:true}, trackUserLocation:true}));
    map.addControl(new mapboxgl.Hash());

    // Setup Geocoder
    function parseLngLat(txt){ const p=txt.split(','); if(p.length!==2)return null; const lng=+p[0],lat=+p[1]; if(Math.abs(lng)>180||Math.abs(lat)>90)return null; return [lng,lat]; }
    function coordinatesGeocoder(q){const c=parseLngLat(q);if(!c)return null;return[{type:'Feature',geometry:{type:'Point',coordinates:c},place_name:c.join(','),center:c}];}

    const geocoder=new MapboxGeocoder({accessToken:mapboxgl.accessToken,mapboxgl:mapboxgl,marker:false,flyTo:false,localGeocoder:coordinatesGeocoder,limit:5,placeholder:'Search address or lng,lat‚Ä¶'});
    document.body.insertAdjacentElement('beforeend', geocoder.onAdd(map));

    geocoder.on('result', e=>{if(!e.result.center)return;flyToCoordinates(e.result.center,e.result.place_name)});
    geocoder.on('clear',()=>{if(searchMarker){searchMarker.remove();searchMarker=null;}});

    const toastEl=document.getElementById('toast');
    function showToast(m){toastEl.textContent=m;toastEl.classList.add('show');setTimeout(()=>toastEl.classList.remove('show'),1600);}
    function safeFlyTo(o){const go=()=>map.flyTo({duration:1200,curve:1.5,speed:1.2,...o});map.isStyleLoaded()?go():map.once('idle',go);}
    function updateInfo(){const c=map.getCenter(),z=map.getZoom();document.getElementById('coordinates').textContent=`${c.lng.toFixed(4)},${c.lat.toFixed(4)}`;document.getElementById('zoom-level').textContent=z.toFixed(1);}
    function flyToLocation(c){safeFlyTo({center:c,zoom:12});}
    function flyToCoordinates(c,n){if(searchMarker)searchMarker.remove();searchMarker=new mapboxgl.Marker({color:'#28a745'}).setLngLat(c).setPopup(new mapboxgl.Popup().setHTML(`<h4>${n}</h4>`)).addTo(map);safeFlyTo({center:c,zoom:14});}
    function toggleLayer(t){if(t==='offices'){const chk=document.getElementById('officeLayer').checked;officeMarkers.forEach(m=>chk?m.addTo(map):m.remove());}if(t==='geojson'){const chk=document.getElementById('geojsonLayer').checked;if(map.getLayer('geojson-points'))map.setLayoutProperty('geojson-points','visibility',chk?'visible':'none');}if(t==='home'){const chk=document.getElementById('homeLayer').checked;if(homeMarker)chk?homeMarker.addTo(map):homeMarker.remove();}}
    function toggleLayerPanel(){const c=document.getElementById('layerPanelContent');const a=document.getElementById('panelArrow');const sh=c.style.display==='none';c.style.display=sh?'block':'none';a.textContent=sh?'‚ñ≤':'‚ñº';}

    map.on('load',()=>{
      homeMarker=new mapboxgl.Marker({color:'#ff6b6b'}).setLngLat([-78.644,35.789]).setPopup(new mapboxgl.Popup().setHTML('<h4>Home</h4>')).addTo(map);
      const offices=[
        { coords: [-78.6386, 35.7721], name: 'Raleigh Office', city: 'Raleigh, NC' },
        { coords: [-80.8414, 35.2271], name: 'Charlotte Office', city: 'Charlotte, NC' },
        { coords: [-80.2442, 36.0999], name: 'Winston-Salem Office', city: 'Winston-Salem, NC' },
        { coords: [-82.554, 35.5951], name: 'Asheville Office', city: 'Asheville, NC' },
        { coords: [-78.8986, 35.994], name: 'Durham Office', city: 'Durham, NC' },
        { coords: [-82.394, 34.8526], name: 'Greenville Office', city: 'Greenville, SC' },
        { coords: [-97.0403, 33.0462], name: 'Lewisville Office', city: 'Lewisville, TX' },
        { coords: [-81.3792, 28.5383], name: 'Orlando Office', city: 'Orlando, FL' },
        { coords: [-82.4572, 27.9506], name: 'Tampa Office', city: 'Tampa, FL' }
      ];

      offices.forEach((office) => {
        const el=document.createElement('div');
        el.textContent='üè¢';
        el.style.fontSize='24px';
        const m=new mapboxgl.Marker({element:el}).setLngLat(office.coords).setPopup(new mapboxgl.Popup().setHTML(`<h4>${office.name}</h4><p>${office.city}</p>`)).addTo(map);
        officeMarkers.push(m);
      });

      loadGeoJSONData();updateInfo();
    });

    map.on('move',updateInfo);

    async function loadGeoJSONData(){try{const r=await fetch('https://raw.githubusercontent.com/McAdams-Admin/mapbox_test/main/Request_Form_Output_Test.geojson');if(!r.ok)throw new Error(r.status);const d=await r.json();if(!map.getSource('geojson-data'))map.addSource('geojson-data',{type:'geojson',data:d});else map.getSource('geojson-data').setData(d);if(!map.getLayer('geojson-points'))map.addLayer({id:'geojson-points',type:'circle',source:'geojson-data',paint:{'circle-radius':8,'circle-color':'#3498db'}});}catch(e){console.error(e);showToast('GeoJSON failed');}}
  </script>
</body>
</html>
<!-- FULL MAPBOX APP END -->

















